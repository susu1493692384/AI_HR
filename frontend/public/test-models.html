<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>测试模型列表</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .model { padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 4px; }
        .model.chat { border-left: 4px solid #4CAF50; }
        .model.embedding { border-left: 4px solid #2196F3; }
        h2 { color: #333; }
        .count { font-weight: bold; color: #666; }
    </style>
</head>
<body>
    <h1>智谱AI模型列表测试</h1>

    <div class="section">
        <button onclick="loadModels()">加载模型列表</button>
        <span id="status" class="count"></span>
    </div>

    <div id="result"></div>

    <script>
        async function loadModels() {
            const statusEl = document.getElementById('status');
            const resultDiv = document.getElementById('result');

            statusEl.textContent = ' 加载中...';
            resultDiv.innerHTML = '';

            try {
                const response = await fetch('http://localhost:8000/api/v1/llm/my_llms?include_details=true&_t=' + Date.now());
                const data = await response.json();

                if (data.code === 0 && data.data && data.data['ZHIPU-AI']) {
                    const models = data.data['ZHIPU-AI'].llm || [];

                    statusEl.textContent = ` 共 ${models.length} 个模型`;

                    // 按类型分组
                    const chatModels = models.filter(m => m.type === 'chat');
                    const embeddingModels = models.filter(m => m.type === 'embedding');

                    // 显示聊天模型
                    let html = '<div class="section"><h2>聊天模型 (' + chatModels.length + ')</h2>';
                    chatModels.forEach(m => {
                        const isNew45 = m.name.includes('4.5');
                        html += `<div class="model chat">
                            <strong>${m.name}</strong>${isNew45 ? ' <span style="color:green">✨ GLM-4.5</span>' : ''}
                            <br>最大token: ${m.max_tokens}
                            <br>状态: ${m.status === '1' ? '✅ 启用' : '❌ 禁用'}
                        </div>`;
                    });
                    html += '</div>';

                    // 显示嵌入模型
                    html += '<div class="section"><h2>嵌入模型 (' + embeddingModels.length + ')</h2>';
                    embeddingModels.forEach(m => {
                        html += `<div class="model embedding">
                            <strong>${m.name}</strong>
                            <br>最大token: ${m.max_tokens}
                            <br>状态: ${m.status === '1' ? '✅ 启用' : '❌ 禁用'}
                        </div>`;
                    });
                    html += '</div>';

                    resultDiv.innerHTML = html;

                    // 检查GLM-4.5系列
                    const has45Models = models.some(m => m.name.includes('4.5'));
                    if (!has45Models) {
                        resultDiv.innerHTML += '<div class="section" style="background:#fff3cd;border-color:#ffc107"><strong>⚠️ 警告：</strong>未找到GLM-4.5系列模型！<br>请运行: <code>python add_zhipu_models_sync.py</code></div>';
                    }

                } else {
                    statusEl.textContent = ' 加载失败';
                    resultDiv.innerHTML = '<div class="section" style="background:#f8d7da;border-color:#f5c6cb">API返回数据格式错误</div>';
                }
            } catch (error) {
                statusEl.textContent = ' 加载失败';
                resultDiv.innerHTML = '<div class="section" style="background:#f8d7da;border-color:#f5c6cb">错误: ' + error.message + '</div>';
            }
        }

        // 页面加载时自动执行
        window.onload = loadModels;
    </script>
</body>
</html>
